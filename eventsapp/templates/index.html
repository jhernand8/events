<!DOCTYPE html>
<html>
<head>
<style>
.groupDiv ul {
    padding-top: 10px;
    margin-top: 0px;
}
groupDiv .groupName {
    font-size: 18px;
    font-weight: bold;
}

li.nextTwoWeeks {
  font-weight: bold;
  padding-top: 5px;
  padding-bottom: 5px;
}

</style>
{% load static %}
<script src="{% static 'date.js'%}"></script>
<script src="https://fb.me/react-0.12.0.js"></script>
<script src="https://fb.me/JSXTransformer-0.12.0.js"></script>
<script type="text/jsx">
/** @jsx React.DOM */
var groups = {{ groups }};

var events = {{ events }};


var EventsForGroup = React.createClass({
  render: function() {
  
    var evList = [];
    for (var i = 0; i < this.props.events.length; i++) {
      var ev = this.props.events[i];
      var evEl = <EventElement event={ev} dateFormat="ddd MMM d, yyyy H'/>;
      evList.push(evEl);
    }
    return (<div className="groupDiv">
        <span className="groupName">
          <a href={"https://www.meetup.com/" + this.props.group.url + "/"}>{this.props.group.url}</a>
        </span>
        <br/>
        <ul>{evList}</ul>
      </div>);

  }
});

/**
 * Element to render a single event in an li.
 */
var EventElement = React.createClass({
  render: function() {
    var ev = this.props.event;
    var city = "";
    if (ev.city && ev.city != null) {
      city = ev.city;
    }
    var evDate = "";
    var dateDiff = 200;
    if (ev.time && ev.time != null) {
      evDate = (new Date(Number(ev.time))).toString(this.props.dateFormat);
      var tDiff = (new Date(Number(ev.time))).getTime() - (new Date()).getTime();
      dateDiff = tDiff / (1000  * 60 * 60 * 24);
    }
    var fontSize = 16;
    var evLiClass = "normal";
    if (dateDiff > -1 && dateDiff < 14) {
      evLiClass = "nextTwoWeeks";
    }
    if (dateDiff > 0 && dateDiff < 8) {
      evLiClass += " nextWeek ";
    }
    if (dateDiff > 20) {
      evLiClass += " beyond";
      fontSize -= 4;
    }
    if (ev.attendees < 5) {
      fontSize -= 4;
    }
    if (ev.attendees > 15) {
      fontSize += 5;
    }
    var liStyle = { fontSize: fontSize + "px"};
    var evEl = <li className={evLiClass} style={liStyle}>{ev.name}  (<span className="numAttend">{ev.attendees}</span>)  <span className="city">{city}</span>  <span className="evDate">{evDate}</span></li>;
    return evEl;
  }
});

var MeetupGroupsAndEvents = React.createClass({
  
  render: function() {

    var groupList = [];
    for (var i = 0; i < this.props.groups.length; i++) {
      var currGroup = this.props.groups[i];
      var currId = currGroup.id;
   
      // filter for events for the current group   
      var eventsForGroup = [];
      for (var j = 0; j < this.props.events.length; j++) {
        if (this.props.events[j].groupId === currId) {
          eventsForGroup.push(this.props.events[j]);
        }
      }

      groupList.push(<EventsForGroup group={currGroup} events={eventsForGroup}/>);

    }
    return <div>{groupList}</div>;
  }
});

var UpcomingWeekend = React.createClass({

  render: function() {

    var groupById = {};
    for (var i = 0; i < this.props.groups.length; i++) {
      groupById[this.props.groups[i].id + ""] = this.props.groups[i];
    }

    var els = [];

    for (var e = 0; e < this.props.events.length; e++) {
      var ev = this.props.events[e];
      var evDate = new Date(Number(ev.time));
      if (evDate.getDay() === 0 || evDate.getDay() > 4) {
        var tDiff = (new Date(Number(ev.time))).getTime() - (new Date()).getTime();
        dateDiff = tDiff / (1000  * 60 * 60 * 24);
        if (dateDiff < 7) {
          var evEl = <EventElement event={ev} dateFormat="ddd MM d  H"/>;
          els.push(evEl);
        }
      }
    }     

    return <div>
      <span id="upcomingTitle">Upcoming by date</span><br/>
      <ul> {els} </ul>;
    </div>

  }

});


React.renderComponent(
  <MeetupGroupsAndEvents groups={groups} events={events} />,
  document.getElementById("groupsDiv"));
React.renderComponent(
  <UpcomingWeekend groups={groups} events={events} />,
  document.getElementById("upcoming"));
</script>
</head>
<body>

<h2>Events</h2>
<h2>Groups</h2>
<div id="groupsDiv"></div>
<br/><br/>
<div id="upcoming"></div>
<h2>Add Meetup Groups</h2>
<form action="followGroups" method="POST">
  <ul>
    <li><input type="text" name="meetupgroup"/></li>
    <li><input type="text" name="meetupgroup"/></li>
    <li><input type="text" name="meetupgroup"/></li>
    <li><input type="text" name="meetupgroup"/></li>
    <li><input type="text" name="meetupgroup"/></li>
  </ul>
  {% csrf_token %}
  <input type="Submit" value="Submit"/>
</form>

<br/><br/>
Refreshes at 0:30 UTC(5:30pm in summer), and 16:00 UTC(9am in summer)<br/><br/><br/>
</body>
</html>

